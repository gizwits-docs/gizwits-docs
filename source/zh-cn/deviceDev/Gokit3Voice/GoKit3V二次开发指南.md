

title: GoKit3(V)二次开发--开发指南
---

# 初见GoKit3(V)

![Alt text](/assets/zh-cn/deviceDev/Gokit3Voice/dev/image3.jpeg)

上图既是GoKit3(V)开发套件，此套件支持语音识别、语音控制传感器。使用Lark7618模组进行智能硬件产品开发时，有以下几点需要注意：

1、Lark7618支持语音识别功能，且符合标准机智云接入协议。

2、使用Lark7618模组进行产品开发时需采用MCU方式进行开发，即模组插到功能板模组接口的MCU侧。

3、Lark7618需配合底板使用，支持Arduino版和STM32版。





# 开发
GoKit3(V)开发套件的开发是通过MCU获取传感器数据或控制传感器的，所以GoKit3(V)的开发工作分两部分，一个是MCU端的开发工作，另一个是将数据点与语音控制命令绑定。下面分别介绍下这两部分的开发工作。

## 1 MCU端开发
Lark7618符合机智云标准接入协议，通过串口与MCU进行数据交互，交互协议为机智云模组串口通信协议，开发者可以使用MCU的方式进行智能硬件的开发。开发步骤如下：

1、在机智云自助开发平台定义产品。并下载《XXX-机智云接入串口通信协议文档》。

2、根据《XXX-机智云接入串口通信协议文档》实现MCU端程序。

具体开发步骤和方法可以参考**《10_GoKit3(V)二次开发--程序移植》**、**《11_GoKit3(V)二次开发--程序详解》**，本节不再进行详细说明。

## 2 命令绑定数据点

### 2.1 术语

| 术语      |     说明 | 
| :-------- | :-------- | 
| 机智云   |   机智云是广州机智云物联网科技有限公司的旗下品牌，是一家智能硬件自助开发和物联网（IOT）云服务平台，面向企业／开发者提供智能硬件PaaS及SaaS云服务，业务覆盖智能家居、健康穿戴、智慧交通、智慧城市、商业及工业等应用。参考http://www.gizwits.com/ |  
| 机智云productkey | 机智云产品标识码，开发者通过机智云后台创建新产品后，自动生成的一个32位字符串。系统通过productkey将用户在宇音天下平台上注册的产品和机智云的产品进行绑定|
|机智云产品json文件   |  定义机智云产品数据点的json文件，系统需要下载机智云产品json文件才能解析出数据点从而实现命令和数据点的关联 |
| 宇音天下平台  |  由宇音天下公司开发为Lark7618模块提供升级资源管理的云服务平台 |
| 命令	   |   不同的业务动作称之为命令，如开灯和关灯就是两个不同命令，一个命令可拥有多个词条|
| 词条   |  命令的不同问法称之为词条，如开灯，可以有“开灯”、“把灯打开”、“灯打开”等多种语义相近的词条 |
| 命令目录   |   为了方便命令管理将命令按照树形目录结构管理。系统提供“内部控制”、“通用控制”、“家居控制”等预先定义的命令目录 |
| 自定义命令	    |  非系统自带、由用户自行添加的命令 |
| 产品注册	   | 向宇音天下后台提交购买模块的公司和开发产品等信息的过程称为产品注册 |
| 产品登录    | 	用注册得到的账号登录宇音天下后台 |
| 出厂烧录  | 通过串口将出厂参数烧录到模块的过程|
| 生成升级资源   |  将命令词条和MP3统一打包成供模块解析的资源bin文件 |
| 上传升级资源	   |  将资源bin文件上传到宇音天下平台供模块下载更新|
| 加载上次资源	  |  将系统管理的词条、MP3和出厂参数设置恢复到最近上传升级资源时的编辑状态，可在此基础上做进一步修改 |
| 数据点	 | 数据点是在机智云平台定义的和设备通讯所承载的单个数据，包含类型、长度和取值范围等属性| 


### 2.2 资源管理工具业务流程
1)  在宇音天下平台注册用户账号**（开发阶段建议先注册测试账号）**，定义产品；

2)  管理用户出厂参数，并将出厂参数烧录到模块中；
 
3） 对于机智云开发者，在业务参数中设置机智云productkey,下载机智云产品json文件。

4)  命令管理：将命令目录中选中的命令导入到命令管理窗口，管理命令以及对应词条；机智云用户还需设置命令对应的机智云产品数据点。

4)  MP3管理：替换系统MP3,选取内置MP3,加载用户MP3； 

5)  生成升级资源，并将升级资源上传到宇音天下平台供模块下载；
 
6)  重启模块（模块断电重新上电）或随机在9:00-11:00和15:00-17:00任意时间点，模块自动下载升级至更新资源； 

7)  测试模块命令词条和MP3资源下载是否正确； 

8)  更新资源重复步骤3，直到形成最终的产品资源；

**以上工作做完后，用户进入产品发布阶段，按照下列流程**

1)  重新在宇音天下平台注册正式账号（此时上次测试账号管理的词条和mp3资源会自动应用到新的正式账号中）； 
 
2)  将出厂参数依次烧录到所有模块中；

3)  生成升级资源，并将升级资源上传到宇音天下平台供模块下载更新；
 
4)  客户拿到产品模块后，通过APP设置模块WIFI上网参数；
 
5)  模块自动升级产品资源； 

6)  用户根据需要在产品上线后升级新的产品资源；

**注：**

>  产品发布请注册正式账号，不同产品需要注册不同的正式账号，开发阶段请不要申请正式账号进行产品测试，避免正式账号下存在过多的测试升级资源文件。

	
### 2.3 资源管理工具使用方法

#### 2.3.1 程序启动

第一次使用资源管理工具软件时鼠标右击![Alt text](/assets/zh-cn/deviceDev/Gokit3Voice/dev/image4.png)
，以管理员方式运行，软件检测到本机如果没有注册Mscomm32.ocx（串口通讯控件）会自动注册Mscomm32.ocx，如果360之类的安全软件提示程序正在修改注册表，请允许本次操作。

![Alt text](/assets/zh-cn/deviceDev/Gokit3Voice/dev/image5.png)

![Alt text](/assets/zh-cn/deviceDev/Gokit3Voice/dev/image6.png)


#### 2.3.2 程序主界面

主界面包括词条更新、MP3更新和出厂参数配置和业务参数四个tab页，分别管理词条、MP3和出厂参数，业务参数。其中出厂参数通过串口烧录到所有模块中，词条和MP3、业务参数所做的改变需要打包成升级资源供模块下载更新。即出厂参数是在产品提交给用户前由厂家预先烧录好，而词条、MP3、业务参数是产品上线运行后由厂家进行修改后打包上传到宇音天下平台供模块下载更新升级。
![Alt text](/assets/zh-cn/deviceDev/Gokit3Voice/dev/image7.png)

**注：程序提供右键菜单，一些操作会放在右键菜单里，用户可在操作窗口中用鼠标右键弹出菜单执行相应功能。**

#### 2.3.3 注册产品
用户拿到模块后首先必须向宇音天下平台注册产品。注册时必须正确填写公司名称和产品名称（注册信息必须如实填写，宇音天下有权禁止非法的注册账号）、登录账号等信息。 
![Alt text](/assets/zh-cn/deviceDev/Gokit3Voice/dev/image8.png)

**注：在开发阶段请注册测试账号。**

7618模块支持的产品形态：

1）模式2：集成机智云数据点功能可支持远程控制的应用模式；用户和机智云合作，在机智云平台定义产品，通过机智云平台实现设备远程控制，wifi芯片采用宇音天下公司7618芯片，集成wifi上网和语音控制功能。

![Alt text](/assets/zh-cn/deviceDev/Gokit3Voice/dev/image9.png)

注：对于机智云用户，如果想实现语音控制设备，请选择模式2。

#### 2.3.4 产品登录

用产品注册账号登录宇音天下平台。在进行【出厂烧录】、【生成升级资源】、【上传升级资源】时如果未登录宇音天下平台系统会提示登录。

![Alt text](/assets/zh-cn/deviceDev/Gokit3Voice/dev/image10.png)

#### 2.3.5 出厂参数配置

用户注册产品并登录后，可设置出厂参数，可在出厂时设置的参数如下图所示：

![Alt text](/assets/zh-cn/deviceDev/Gokit3Voice/dev/image11.png)

wifi用户名和密码在公司内部产品测试阶段可输入公司的wifi账号信息，保证模块可以正常上网。

设置完成后点击【保存】保存配置参数。

#### 2.3.6 出厂烧录

将配置的出厂参数和注册的产品信息烧录到模块中。

![Alt text](/assets/zh-cn/deviceDev/Gokit3Voice/dev/image12.png)

1. 请检查以上产品信息是否正确

2. 请检查出厂参数配置是否正确

3. 请选择串口号

4. 请将所有模块依次连接串口，执行“开始烧录”

5. 将依次把产品信息和出厂参数配置烧录到模块中

注：不要开机后立刻执行出厂烧录，约等待20秒左右时间再进行出厂烧录。

#### 2.3.7 业务参数设置

**1) 设置是否允许固件升级**

![Alt text](/assets/zh-cn/deviceDev/Gokit3Voice/dev/image13.png),如果不允许7618芯片固件升级请选择否。

注：修改是否允许固件升级参数项设置后，必须点击上传升级资源，芯片下载正常工作后才起作用。

用户如果验证Lark7618固件运行稳定，无需宇音天下后续对固件进行功能升级则可选择不允许固件升级。

**2) 设置机智云productkey**

针对用户在机智云平台定义产品形态的模式2，输入productkey，点击保存。
![Alt text](/assets/zh-cn/deviceDev/Gokit3Voice/dev/image14.png)

保存机智云的productkey后，点击下载产品json文件，就可将在命令管理中将命令与机智云数据点关联起来，从而实现语音控制设备。

机智云gokit开发套件对应的产品智能宠物屋的productkey是：6f3074fe43894547a4f1314bd7e3ae0b

了解机智云更多详情，请进入官方网站：http://www.gizwits.com/

注：如果用户在注册产品时产品形态选择模式1，则在业务参数设置界面中不会出现与机智云productkey相关的设置项。

#### 2.3.8 命令和词条管理

按下列步骤执行：
**1) 初次执行时选取命令目录中对应的命令，导入到命令窗口中。**

![Alt text](/assets/zh-cn/deviceDev/Gokit3Voice/dev/image15.png)

目录展开/收缩：展开和收缩命令目录

命令展开/收缩：展开和收缩命令

选择所有/全部取消：选中所有命令或取消所有选中。

在命令目录中根据产品应用场合选择合适的命令，然后点击【导入】，导入到命令管理窗口，用户可在命令管理列表中对命令进行编辑管理。

**2)命令管理**

命令管理界面如下图所示：
![Alt text](/assets/zh-cn/deviceDev/Gokit3Voice/dev/image16.png)

命令管理功能有：
	
添加用户自定义命令

删除命令

编辑命令回答

词条管理功能有：

添加词条

删除词条

编辑词条

功能中【选择所有/全部取消】是给选取框设置或取消选中标志，只有选取框打勾的数据才会被打包到资源中。

【删除】和【编辑】功能需要通过鼠标点击数据条目（不是点击选取框）系统将条目显示为蓝底白字后操作才能继续进行，可以通过shift、ctrl键配合鼠标进行成片多选或隔行多选。

#### 2.3.9 MP3更新

MP3资源管理界面如下图所示：

![Alt text](/assets/zh-cn/deviceDev/Gokit3Voice/dev/image17.png)

其中系统MP3可被替换，系统MP3全部打到资源包中。

内置MP3可以通过选取框选中否决定是否打包到资源文件中。

用户可通过专门文件夹整理自己需要的MP3，通过【载入用户MP3】选取用户MP3所在文件夹系统自动将该文件夹下所有MP3全部加载到列表中，用户可通过选取框选中否决定是否将用户MP3打包到资源中。

可删除用户MP3（不是点击选取框，系统将条目显示为蓝底白字后操作才能删除本MP3）。

注意：
1.编辑回答的文本框文本不能超过56个汉字或字母。

2.添加词条的的文本框不能超过20个汉字或字母。

3.添加的MP3文件，文件名不能超过50个汉字或字母(避免文件名过长)，内置资源不能超过2M。

#### 2.3.10 数据点管理

此功能只在注册时选择模式2才生效。

1) 设置数据点

选择命令，弹出右键菜单，选择数据点，设置数据点值，最后点击确定保存。

![Alt text](/assets/zh-cn/deviceDev/Gokit3Voice/dev/image18.png)

![Alt text](/assets/zh-cn/deviceDev/Gokit3Voice/dev/image19.png)

![Alt text](/assets/zh-cn/deviceDev/Gokit3Voice/dev/image20.png)

2) 删除数据点

选择数据点，右键菜单执行【删除数据点】，可清除为命令设置的数据点。

3) 删除所有数据点

在命令管理窗口中弹出右键菜单，执行【清除所有数据点】，系统将删除所有数据点的定义。


#### 2.3.11 生成升级资源

系统将选择的命令、词条、MP3资源统一打包为升级资源，供模块下载更新。

升级资源前必须登录宇音天下平台，确认本次升级的资源与相对应的产品配套（命令、词条、MP3等资源）。

资源最大不能超过2M，请合理安排资源。

**只有选取框被打勾的内容才打包到资源中，如下图所示：**
![Alt text](/assets/zh-cn/deviceDev/Gokit3Voice/dev/image21.png)


#### 2.3.12 上传升级资源

生成升级资源后可上传升级资源到宇音天下云平台供模块下载。升级的资源关联到指定的产品，只要模块烧录的产品信息和该资源对应的产品信息一致，模块就会自动下载升级资源。

#### 2.3.13 加载上次资源

将系统管理的词条、MP3和出厂参数设置恢复到最近上传升级资源时的编辑状态，可在此基础上做进一步修改。

每次上传升级资源时系统将升级资源在本地做备份，加载上次资源系统将放弃本地所做的修改，将词条、MP3和出厂参数恢复到上次上传时的状态。

**注：加载上次资源应在同一电脑上进行操作，如果用户更换电脑应将上一次操作软件时所在的整个文件夹复制到新的电脑上。**

#### 2.3.14 正式产品发布

在用测试账号对模块进行烧录、资源升级测试后，用户已经形成了稳定的命令、词条和MP3资源被保存到资源管理工具数据库中。

按照下列步骤可将测试账号测试通过的词条、MP3资源配置应用到正式账号中，从而进行正式产品发布：

a) 以测试账号登录后，在界面中执行注册，向宇音天下注册正式账号，账号类型选择![Alt text](/assets/zh-cn/deviceDev/Gokit3Voice/dev/image22.png)
，如实填写公司、产品信息。注册正式账号后，上次针对测试账号所做的命令、词条和MP3资源自动绑定到正式账号中，即本地数据自动与新账号关联。注：必须先以测试账号登录后再注册正式账号才能将测试账号最后形成的稳定的资源配置自动迁移到正式账号上，否则用户还需在正式账号重新进行资源配置。

b)将产品信息依次烧录到所有模块中。

c)重新生成资源、上传升级资源（注册了新的正式账号需要重新生成和上传资源到宇音天下平台供模块下载）

### 2.4 机智云gokit开发套件语音控制功能演示

本章节适宜于用户购买了机智云与宇音天下合作提供的gokit套件（采用北京宇音天下开发的Lark7618模块，集成wifi通讯、语音识别和语音合成功能），可通过语音控制设备。

按照下列操作步骤实现通过语音控制gokit开发套件的电机转动、灯光控制。

1) 注册账号时产品形态选择模式2

2) 在命令窗口中选择转动【转动控制】、【灯光】，然后导入
![Alt text](/assets/zh-cn/deviceDev/Gokit3Voice/dev/image23.png)

在业务参数中设置机智云宠物屋的productkey,输入：6f3074fe43894547a4f1314bd7e3ae0b，下载产品定义json文件。

![Alt text](/assets/zh-cn/deviceDev/Gokit3Voice/dev/image24.png)

3) 设置电机命令对应的数据点

![Alt text](/assets/zh-cn/deviceDev/Gokit3Voice/dev/image25.png)

![Alt text](/assets/zh-cn/deviceDev/Gokit3Voice/dev/image26.png)

**说明：按照机智云宠物屋数据点定义，电机转速是-5~5之间整数值，5为正转最大转速，-5为反转最大转速，0为停止转动。**

依次设置电机相关的其它数据点。

4) 设置灯控数据点
设置【开灯】命令的数据点

![Alt text](/assets/zh-cn/deviceDev/Gokit3Voice/dev/image27.png)

![Alt text](/assets/zh-cn/deviceDev/Gokit3Voice/dev/image28.png)

【关灯】则选择数据点“开启/关闭红色灯(LED_OnOff)”,设置值选择“否(false)”。

【红色灯光】则选择数据点“设置LED红色值（LED_R）”,设置值254。

【绿色灯光】则选择数据点“设置LED红色值（LED_G）”,设置值254。

【蓝色灯光】则选择数据点“设置LED红色值（LED_B）”,设置值254。

【黄色灯光】则选择数据点“设置LED组合颜色（LED_COLOR）”,设置值黄色。

【紫色灯光】则选择数据点“设置LED组合颜色（LED_COLOR）”,设置值紫色。

【粉色灯光】则选择数据点“设置LED组合颜色（LED_COLOR）”,设置值粉色。

5)出厂参数烧录

6)上传升级资源

7)重启gokit套件，下载升级资源

8)用设置的唤醒名唤醒Lark7618模块，测试下列命令

开灯，关灯，红色灯光，蓝色灯光，高速转动，低速转动等，观察gokit套件设备是否做出响应。


### 2.5 使用注意事项

1）串口通讯采用Mscomm32.ocx控件，系统会自动注册该控件，如果进入烧录系统弹出程序运行错误窗口，说明Msconn32.ocx未能自动注册成功（一般是在win7及其以上版本机器），请改用管理员身份执行程序。

![Alt text](/assets/zh-cn/deviceDev/Gokit3Voice/dev/image29.png)

还不能烧录，则执行手工注册，按下列步骤执行：

■ 先将软件所在目录下的Mscomm32.ocx拷贝到c:\windows\system32。

■ 以管理员方式运行cmd.exe进入命令行窗口

点桌面左下角开始-所有程序-附件-右键命令提示符-选择以管理员身份运行（如图1），打开DOS界面后在命令行窗口执行 regsvr32.exe  c:\windows\system32\Mscomm32.ocx

![Alt text](/assets/zh-cn/deviceDev/Gokit3Voice/dev/image30.png)

![Alt text](/assets/zh-cn/deviceDev/Gokit3Voice/dev/image31.png)

2）软件可执行程序为:Lark7618ResTool.exe,请勿改为中文文件名。

3）如果登录是新注册用户，必须配置好出厂参数，执行【出厂烧录】程序，才能正常生成、更新！

4）请正确填写注册信息，保存好账号密码，系统暂未提供修改注册信息功能，如需重置请和宇音天下联系。

5）只有在注册时产品形态选择模式2，即支持机智云才可实现命令与机智云数据点关联，了解机智云请参考http://www.gizwits.com。

6）本工具建议只在一台计算机上使用，应避免多人在不同计算机上用同一账号使用本工具。如果要更换计算机，请将本软件整个文件夹全部复制到新的计算机，否则在新的计算机上使用工具将不会拥有其他计算机编辑的词条。


