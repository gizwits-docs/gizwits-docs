 
# 产测简介

产测是生产环节中重要的部分，保证了产品的质量，提升自身产品形象。机智云产测工具为批量生产的产品提供了方便快捷的模块与MCU产测方式。在大型生产时，保证模块与MCU可正常使用。

该文档为产测使用流程，硬件如何开启产测模式请参考产品开发资源中MCU开发资源文档。

# 产测前准备

## 1.产品上架

使用产测工具，必须让产品先上架。由产品创建者向机智云申请发布。机智云将免费为你提供人工审核以及严谨的测试。
 
 ![name](/assets/zh-cn/deviceDev/debug/test/1478080883108.png)

按要求填写发布申请表单，提交申请后寄送设备样品，我们会在5～7个工作日完成审核工作。

申请发布成功后，才可进行产测文件生成以及产测App下载。


## 2.生成产测文件
 
   ![name](/assets/zh-cn/deviceDev/debug/test/1478081465319.png)
  
产品上架后，在产品服务中点击“添加配置文件”。

 ![name](/assets/zh-cn/deviceDev/debug/test/1478081489006.png)

输入配置名称后，点击“添加步骤”添加需要进行的产测步骤，产测数据点为设备定义数据点。每点击一次“添加步骤”可以添加一个数据点步骤。指令添加完成后点击保存，会生成一个产测文件。

 
## 3.下载产测app
在产测文件下方点击“产测App下载”即可扫码下载App至手机中。（产测App只提供android版本）

  ![name](/assets/zh-cn/deviceDev/debug/test/1478081515011.png)


## 4.下载产测文件
 
   ![name](/assets/zh-cn/deviceDev/debug/test/1478081550135.png)
 
打开产测app后，点击下载配置文件会弹出二维码扫描框，点开设备产品配置文件下载，扫描二维码，手机端即可得到产测文件。

 ![name](/assets/zh-cn/deviceDev/debug/test/1478081584399.png)
 
  ![name](/assets/zh-cn/deviceDev/debug/test/1478082019314.png)

界面说明：

|栏目名称|说明|
|--|--|
|文件名称|此次扫码下载的产测配置文件名称|
|产品名称|产测的设备名称，后面为产品的Product Key|
|测试版本|此次产测配置文件的版本|
|步骤、数据点、指令|产测需要执行的步骤|


## 5.搭建路由器环境

5.1.路由器允许转发局域网内的广播包，不能勾选“AP隔离”选项。

5.2.路由器要用2.4GHz的频段。

5.3.路由器不能对2415，12414，12416这三个端口的访问加以限制。

5.4.厂测之前需要配置路由器的信息，按照如下信息配置：


|SSID|GIZWITS_TEST_1（或者GIZWITS_TEST_2）|
|--|--|
|Password|GIZWITS_TEST_PASS|
|加密方式|WPA2PSK|

在产测过程中可以使用两个路由器来进行测试，分别设置ssid为GIZWITS_TEST_1或者GIZWITS_TEST_2，密码一致。测试过程中，模组会随机连接两个路由器，提高产测效率。

5.5.产测路由器不能处于级联模式，必须使用独立路由器进行产测。

# 开始产测

把设备配置成厂测模式，这时候设备的wifi模组会自动连上GIZWITS_TEST_1或者GIZWITS_TEST_2路由器。装有厂测APP的手机也需要连到这个路由器。
 
  ![name](/assets/zh-cn/deviceDev/debug/test/1478082261395.png)

 
点击app端开始测试按钮，进入产测状态，界面显示正在搜索设备。当有设备被发现的时候，将对设备进行测试。

 ![name](/assets/zh-cn/deviceDev/debug/test/1478082270994.png)

 
界面上方显示总发现设备数，测试成功设备数，测试失败的设备数。

测试设备列表中依次显示的设备顺序为：测试中的设备、待测试的设备、失败的设备、成功的设备。

点击查看，可以看到具体的测试内容：
 
  ![name](/assets/zh-cn/deviceDev/debug/test/1478082289710.png)

点击停止按钮，将出现弹框提示，并结束本次测试，保存测试结果。
 
 ![name](/assets/zh-cn/deviceDev/debug/test/1478082339713.png)



# 查看产测结果日志
 
  ![name](/assets/zh-cn/deviceDev/debug/test/1478082392592.png)

 
停止产测后，打开app菜单栏，选择测试报告选项，可查看历史测试报告。测试报告的名字为测试的时间，最新测试的结果排在最前面。
 
 ![name](/assets/zh-cn/deviceDev/debug/test/1478082397951.png)

测试报告中可查看本次测试的合格产品和不合格产品数量以及MAC地址。
长按相应的栏目可以删除单条记录：
 
  ![name](/assets/zh-cn/deviceDev/debug/test/1478082421696.png)
 
点击菜单可选择删除全部记录。
点击对应的栏目，可以看到具体测试的设备，失败的设备优先排列在最前面。 
点击查看可以看到具体的测试内容。
 
 ![name](/assets/zh-cn/deviceDev/debug/test/1478082430874.png)

# 常见问题

**1.产测路由器需要连接外网么？**

解答：不需要，路由器接不接外网都可以测试。

**2.产测结果提示“执行失败”可能的原因是什么？**

解答：
2.1、提示“等待设备可控，执行失败”，出现这条结果表示设备可能还未准备好，可以点击“重测”按钮来对产品进行重新测试，如果再次出现这个问题，可重启设备后再进行测试，如果还是出现这个错误，则表示该设备不通过测试。
2.2、提示“第XX步，…… 执行失败”，出现这条结果的原因是因为APP向设备下发控制指令后，没有收到设备主动上报的数据，导致测试失败。可以点击重测来进行重新测试。

**3.扫码下载配置文件提示失败？**

解答：扫码下载配置文件的过程中需要手机能连接互联网，并且网络状态良好，可稍候重新扫码测试。

**4.测试过程中设备成功连接上了产测路由器，APP无法发现设备进行测试。**

解答：出现这个原因需要测试网络环境能否收发UDP广播包，具体方法如下：

4.1.手机安装机智云DEMO APP，下载链接：

http://site.gizwits.com/zh-cn/developer/resource/demo_app?protoc=WIFI

4.2.将手机WiFi网络链接到测试网络环境中，并且查看手机在该网络环境中的IP地址。如下图：
 
  ![name](/assets/zh-cn/deviceDev/debug/test/1478086837594.png)

 ![name](/assets/zh-cn/deviceDev/debug/test/1478086843863.png)

 
4.3.安装wireshark抓包工具，下载链接：

https://www.wireshark.org/#download

4.4.打开wireshark工具，按照下图指引设置。
 
  ![name](/assets/zh-cn/deviceDev/debug/test/1478086880035.png)

 
4.5.	设置wireshark后，Wireshark跳转到抓包界面，打开机智云Demo APP。

4.6.对wireshark抓包条件设置过滤，如下图：

 ![name](/assets/zh-cn/deviceDev/debug/test/1478086898188.png)
 
4.7.参考上图中设置，等待数分钟（等待期间，可以点击机智云Demo APP的设备列表刷新功能），如果可以看到Destination：255.255.255.255的数据包，则说明该测试网络环境具备UDP广播包的传输条件。如果没有，则说明该环境不具备UDP广播包的传输条件。
